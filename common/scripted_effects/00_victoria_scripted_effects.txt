voyage_of_potemkin = {
	while = {
		limit = {
			any_state = {
				has_variable = potemkin_destination_state
				OR = {
					owner = ROOT
					owner = {
						is_subject_of = ROOT
					}
				}
			}
		}
		random_state = {
			limit = {
				has_variable = potemkin_destination_state
			}
			remove_variable = potemkin_destination_state
			random_neighbouring_state = {
				limit = {
					is_coastal = yes
				}
				set_variable = potemkin_destination_state
			}
			debug_log_scopes = yes
		}
	}
	random_state = {
		limit = {
			has_variable = potemkin_destination_state
		}
		remove_variable = potemkin_destination_state
		owner = {
			save_scope_as = potemkin_final_destination
		}
	}
}

adopt_random_antigovernment_ideology = {
	custom_tooltip = {
		text = adopt_random_antigovernment_ideology_tt
		random_list = {
			50 = {
				trigger = {
					owner ?= {
						NOT = {
							ruler ?= {
								has_progressive_ideology = yes
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_council_elective
							}
						}
						add = 50
					}
				}
				set_ideology = ideology:ideology_electoral_reformist
			}
			100 = {
				trigger = {
					ideology_communist_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler ?= {
								has_socialist_ideology = yes
							}
						}
						NOT = {
							has_law = law_type:law_council_elective
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_hereditary
							}
						}
						add = 25
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_autocracy
							}
						}
						add = 25
					}
					if = {
						limit = {
							this.interest_group = {
								is_interest_group_type = ig_laborists
							}
						}
						add = 100
					}
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_fascist_ideology = yes
								}
							}
						}
						add = 100
					}
				}
				set_ideology = ideology:ideology_totalitarian
			}
			100 = {
				trigger = {
					ideology_vanguardist_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler ?= {
								has_socialist_ideology = yes
							}
						}
						NOT = {
							has_law = law_type:law_council_elective
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_hereditary
							}
						}
						add = 25
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_autocracy
							}
						}
						add = 25
					}
					if = {
						limit = {
							this.interest_group = {
								is_interest_group_type = ig_laborists
							}
						}
						add = 100
					}
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_fascist_ideology = yes
								}
							}
						}
						add = 100
					}
				}
				set_ideology = ideology:ideology_authoritarian
			}
			100 = {
				trigger = {
					ideology_anarchist_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler ?= {
								has_socialist_ideology = yes
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_hereditary
							}
						}
						add = 25
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_autocracy
							}
						}
						add = 50
					}
					if = {
						limit = {
							this.interest_group = {
								OR = {
									is_interest_group_type = ig_laborists
									is_interest_group_type = ig_ruralists
								}
							}
						}
						add = 100
					}
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_fascist_ideology = yes
								}
							}
						}
						add = 100
					}
				}
				set_ideology = ideology:ideology_anarchist
			}
			100 = {
				trigger = {
					ideology_fascist_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler ?= {
								has_fascist_ideology = yes
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_liberal_ideology = yes
									has_progressive_ideology = yes
									has_ideology = ideology:ideology_feminist
									has_ideology = ideology:ideology_environmentalist
								}
							}
						}
						add = 50
					}
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_socialist_ideology = yes
								}
							}
						}
						add = 100
					}
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_fascist_ideology = yes
								}
							}
						}
						multiply = {
							value = 0.25
						}
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_open_borders
							}
						}
						add = 100
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_multicultural
							}
						}
						multiply = {
							value = 3
						}
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_cultural_exclusion
							}
						}
						multiply = {
							value = 2
						}
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_council_elective
							}
						}
						multiply = {
							value = 1.5
						}
					}
				}
				set_ideology = ideology:ideology_fascist
			}
			50 = {
				trigger = {
					ideology_atheist_valid_trigger = yes
					owner ?= {
						has_law = law_type:law_religious_institutions
						NOT = {
							ruler ?= {
								has_ideology = ideology:ideology_atheist
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_hereditary
							}
						}
						add = 50
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_religious_institutions
							}
						}
						add = 100
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_theocratic
							}
						}
						add = 200
					}
				}
				set_ideology = ideology:ideology_atheist
			}
			50 = {
				trigger = {
					ideology_radical_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler ?= {
								has_socialist_ideology = yes
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_hereditary
							}
						}
						add = 100
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_autocracy
							}
						}
						add = 100
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_oligarchy
							}
						}
						add = 50
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_representative_democracy
							}
						}
						add = 25
					}
				}
				set_ideology = ideology:ideology_electoral_reformist
			}
			100 = {
				trigger = {
					ideology_fascist_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler ?= {
								has_fascist_ideology = yes
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_progressive_ideology = yes
									has_liberal_ideology = yes
									has_ideology = ideology:ideology_feminist
									has_ideology = ideology:ideology_environmentalist
								}
							}
						}
						add = 50
					}
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_socialist_ideology = yes
								}
							}
						}
						add = 100
					}
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_fascist_ideology = yes
								}
							}
						}
						multiply = {
							value = 0.25
						}
					}
					if = {
						limit = {
							owner ?= {
								has_law = law_type:law_council_elective
							}
						}
						multiply = {
							value = 2
						}
					}
				}
				set_ideology = ideology:ideology_fascist
			}
			50 = {
				trigger = {
					ideology_market_liberal_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler ?= {
								has_reactionary_ideology = yes
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								has_law = law_type:law_socialization
							}
						}
						add = 50
					}
					if = {
						limit = {
							owner = {
								has_law = law_type:law_anti_industrialization
							}
						}
						add = 50
					}
					if = {
						limit = {
							owner = {
								has_law = law_type:law_isolationism
							}
						}
						add = 50
					}
					if = {
						limit = {
							owner.ruler = {
								OR = {
									has_socialist_ideology = yes
								}
							}
						}
						add = 100
					}
				}
				set_ideology = ideology:ideology_demagogue
			}
			50 = {
				trigger = {
					ideology_primitivist_valid_trigger = yes
					owner ?= {
						OR = {
							has_law = law_type:law_socialization
							has_law = law_type:law_free_market
							has_law = law_type:law_interventionism
						}
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_primitivist
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								any_scope_state = {
									any_scope_building = {
										is_building_group = bg_heavy_industry
										level >= 5
									}
									state_unemployment_rate > 0.1
								}
							}
						}
						add = 25
					}
					if = {
						limit = {
							owner = {
								any_scope_building = {
									is_building_group = bg_heavy_industry
									level >= 5
								}
							}
						}
						add = 25
					}
					if = {
						limit = {
							OR = {
								is_interest_group_type = ig_ruralists
								is_interest_group_type = ig_moralists
							}
						}
						add = 50
					}
					if = {
						limit = {
							NOR = {
								is_interest_group_type = ig_ruralists
								is_interest_group_type = ig_moralists
							}
						}
						add = -50
					}
					if = {
						limit = {
							owner = {
								has_ruling_interest_group = ig_capitalists
							}
						}
						multiply = {
							value = 2
						}
					}
					if = {
						limit = {
							owner = {
								has_ruling_interest_group = ig_ruralists
							}
						}
						multiply = {
							value = 0.25
						}
					}
				}
				set_ideology = ideology:ideology_primitivist
			}
			50 = {
				trigger = {
					ideology_feminist_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_feminist
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								has_law = law_type:law_hereditary
							}
						}
						add = 25
					}
				}
				set_ideology = ideology:ideology_feminist
			}
			50 = {
				trigger = {
					ideology_humanitarian_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_pacifist	
									has_ideology = ideology:ideology_humanitarian_royalist
								}
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								has_law = law_type:law_hereditary
							}
						}
						add = 25
					}
				}
				set_ideology = ideology:ideology_pacifist
			}

			50 = {
				trigger = {
					ideology_traditionalist_valid_trigger = yes
					NOT = {	
						owner.ruler ?= {
							has_reactionary_ideology = yes
						}
					}
				}
				modifier = {
					if = {
						limit = {
							this.interest_group ?= {
								OR = {
									is_interest_group_type = ig_elites
									is_interest_group_type = ig_moralists
								}
							}
						}
						multiply = {
							value = 2
						}
					}
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_socialist_ideology = yes
									has_progressive_ideology = yes
								}
							}
						}
						add = 50
					}
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_socialist_ideology = yes
								}
							}
						}
						add = 100
					}
					if = {
						limit = {
							owner.ruler ?= {
								OR = {
									has_fascist_ideology = yes
									has_reactionary_ideology = yes
								}
							}
						}
						multiply = {
							value = 0.25
						}
					}
					if = {
						limit = {
							this.interest_group ?= {
								OR = {
									is_interest_group_type = ig_intelligentsia
									is_interest_group_type = ig_capitalists
									is_interest_group_type = ig_laborists
								}
							}
						}
						multiply = {
							value = 0.2
						}
					}
				}
				set_ideology = ideology:ideology_royalist
			}

			50 = {
				trigger = {
					ideology_republican_leader_valid_trigger = yes
					NOT = {	
						owner.ruler ?= {
							has_liberal_ideology = yes
						}
					}
					owner ?= {
						has_law = law_type:law_hereditary
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								has_law = law_type:law_hereditary
							}
						}
						multiply = {
							value = 2
						}
					}
					if = {
						limit = {
							owner = {
								has_law = law_type:law_autocracy
							}
						}
						multiply = {
							value = 2
						}
					}
					if = {
						limit = {
							owner = {
								has_law = law_type:law_oligarchy
							}
						}
						add = 25
					}
					if = {
						limit = {
							owner = {
								has_law = law_type:law_representative_democracy
							}
						}
						add = 25
					}
					if = {
						limit = {
							this.interest_group = {
								is_interest_group_type = ig_elites
							}
						}
						multiply = {
							value = 0.10
						}
					}
				}
				set_ideology = ideology:ideology_electoral_reformist
			}

			50 = {
				trigger = {
					ideology_abolitionist_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_abolitionist	
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								has_law = law_type:law_serfdom
							}
						}
						add = 25
					}
					if = {
						limit = {
							this.interest_group = {
								is_interest_group_type = ig_elites
							}
						}
						multiply = {
							value = 0.05
						}
					}
				}
				set_ideology = ideology:ideology_abolitionist
			}

			50 = {
				trigger = {
					ideology_positivist_valid_trigger = yes
					owner ?= {
						NOR = {
							ruler = {
								has_ideology = ideology:ideology_positivist	
							}
							has_law = law_type:law_technocracy
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								country_has_voting_franchise = yes
							}
						}
						add = 25
					}
					if = {
						limit = {
							owner = {
								has_law = law_type:law_hereditary
							}
						}
						add = 25
					}
					if = {
						limit = {
							owner = {
								has_law = law_type:law_religious_institutions
							}
						}
						add = 25
					}
				}
				set_ideology = ideology:ideology_positivist
			}
			50 = {
				trigger = {
					ideology_humanitarian_royalist_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_pacifist	
									has_ideology = ideology:ideology_humanitarian_royalist
								}
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								has_law = law_type:law_hereditary
							}
						}
						add = 25
					}
				}
				set_ideology = ideology:ideology_humanitarian_royalist
			}
			50 = {
				trigger = {
					ideology_corporatist_leader_valid_trigger = yes
					owner ?= {
						NOR = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_corporatist_leader
								}
							}
							has_law = law_type:law_corporate_state
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								has_law = law_type:law_council_elective
							}
						}
						add = 50
					}
				}
				set_ideology = ideology:ideology_corporatist_leader
			}
			50 = {
				trigger = {
					ideology_liberal_leader_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_liberal_leader
								}
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								country_has_voting_franchise = no
							}
						}
						add = 50
					}
				}
				set_ideology = ideology:ideology_liberal_leader
			}
			50 = {
				trigger = {
					ideology_land_reformer_valid_trigger = yes
					owner ?= {
						NOT = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_land_reformer
								}
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								has_law = law_type:law_serfdom
							}
						}
						add = 50
					}
					if = {
						limit = {
							owner = {
								has_law = law_type:law_tenant_farmers
							}
						}
						add = 25
					}
					if = {
						limit = {
							owner = {
								has_law = law_type:law_land_based_taxation
							}
						}
						add = 50
					}
				}
				set_ideology = ideology:ideology_land_reformer
			}
			50 = {
				trigger = {
					ideology_utilitarian_leader_valid_trigger = yes # Give me your organs.
					culture = {
						has_discrimination_trait = anglophone
					}
					owner ?= {
						any_primary_culture = {
							has_discrimination_trait = anglophone
						}
					}
				}
				modifier = {
					if = {
						limit = {
							owner = {
								NOT = {
									has_law = law_type:law_compulsory_primary_school
								}
							}
						}
						add = 10
					}
					if = {
						limit = {
							owner = {
								NOT = {
									has_law = law_type:law_public_schools
								}
							}
						}
						add = 10
					}
					if = {
						limit = {
							owner = {
								NOT = {
									has_law = law_type:law_womens_suffrage
								}
							}
						}
						add = 10
					}
					if = {
						limit = {
							owner = {
								NOR = {
									has_law = law_type:law_graduated_taxation
									has_law = law_type:law_proportional_taxation
								}
							}
						}
						add = 10
					}
				}
				set_ideology = ideology:ideology_utilitarian_leader
			}
			1 = { # Fallback
				set_ideology = ideology:ideology_jingoist_leader
			}
		}
	}
}

save_agitator_election_scopes = {
	if = {
		limit = {
			has_variable = preset_ideology
		}
		scope:agitator_scope = {
			this.interest_group = {
				save_scope_as = agitator_ig_scope
			}
		}
	}
	else = {
		random_scope_character = {
			limit = {
				has_role = agitator
				NOT = {
					has_variable = agitator_election_participation
				}
			}
			save_scope_as = agitator_scope
			this.interest_group = {
				save_scope_as = agitator_ig_scope
			}
		}
	}

	#Attach to party

	if = {
		limit = {
			any_political_movement = {
				any_supporting_character = {
					this = scope:agitator_scope
				}
			}
		}
		random_political_movement = {
			limit = {
				any_supporting_character = {
					this = scope:agitator_scope
				}
			}
			save_scope_as = agitator_movement_scope
		}
	}
	if = {
		limit = {
			scope:agitator_scope.interest_group = {
				has_party = yes
			}
		}
		scope:agitator_scope.interest_group.party = {
			save_scope_as = agitator_party_scope
		}
	}
	else = {
		if = {
			limit = {
				scope:agitator_scope = {
					has_socialist_ideology = yes
				}
				any_active_party = {
					any_member = {
						leader = {
							has_socialist_ideology = yes
						}
					}
				}
			}
			random_active_party = {
				limit = {
					any_member = {
						leader = {
							has_socialist_ideology = yes
						}
					}
				}
				save_scope_as = agitator_party_scope
			}
		}
		else_if = {
			limit = {
				scope:agitator_scope = {
					has_progressive_ideology = yes
				}
				any_active_party = {
					any_member = {
						leader = {
							has_progressive_ideology = yes
						}
					}
				}
			}
			random_active_party = {
				limit = {
					any_member = {
						leader = {
							has_progressive_ideology = yes
						}
					}
				}
				save_scope_as = agitator_party_scope
			}
		}
		else_if = {
			limit = {
				scope:agitator_scope = {
					has_liberal_ideology = yes
				}
				any_active_party = {
					any_member = {
						leader = {
							has_liberal_ideology = yes
						}
					}
				}
			}
			random_active_party = {
				limit = {
					any_member = {
						leader = {
							has_liberal_ideology = yes
						}
					}
				}
				save_scope_as = agitator_party_scope
			}
		}
		else_if = {
			limit = {
				scope:agitator_scope = {
					has_reactionary_ideology = yes
				}
				any_active_party = {
					any_member = {
						leader = {
							has_reactionary_ideology = yes
						}
					}
				}
			}
			random_active_party = {
				limit = {
					any_member = {
						leader = {
							has_reactionary_ideology = yes
						}
					}
				}
				save_scope_as = agitator_party_scope
			}
		}
		else_if = {
			limit = {
				scope:agitator_scope = {
					has_conservative_ideology = yes
				}
				any_active_party = {
					any_member = {
						leader = {
							has_conservative_ideology = yes
						}
					}
				}
			}
			random_active_party = {
				limit = {
					any_member = {
						leader = {
							has_conservative_ideology = yes
						}
					}
				}
				save_scope_as = agitator_party_scope
			}
		}
		else = {
			random_active_party = { #Chaos reigns
				save_scope_as = agitator_party_scope
			}
		}
	}
	remove_variable = preset_ideology
}

communist_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = communist_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_socialist_ideology = yes
				AND = {
					this.interest_group = {
						is_member_of_party = owner.py:communist_party
					}
					NOT = {
						law_stance = {
							law = law_type:law_council_elective
							value < neutral
						}
					}
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}


fascist_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = fascist_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_fascist_ideology = yes
				AND = {
					this.interest_group = {
						is_member_of_party = owner.py:fascist_party
					}
					NOT = {
						law_stance = {
							law = law_type:law_ethnostate
							value < neutral
						}
					}
				}
			}
			has_role = agitator
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

agrarian_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = agrarian_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_agrarian
				this.interest_group = {
					is_member_of_party = owner.py:agrarian_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

socdem_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = social_democrat_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_social_democracy
				this.interest_group = {
					is_member_of_party = owner.py:social_democrat_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

liberal_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = liberal_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_progressive_ideology = yes
				has_liberal_ideology = yes
				this.interest_group = {
					is_member_of_party = owner.py:liberal_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

conservative_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = conservative_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_traditionalist
				has_ideology = ideology:ideology_slaver
				this.interest_group = {
					is_member_of_party = owner.py:conservative_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

radical_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = social_democrat_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_socialist_ideology = yes
				this.interest_group = {
					is_member_of_party = owner.py:social_democrat_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

free_trade_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = free_trade_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_market_liberal
				this.interest_group = {
					is_member_of_party = owner.py:free_trade_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		save_scope_as = exile_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

enact_preferred_governance_principle = {
	random_interest_group = {
		limit = {
			is_in_government = yes
			is_strongest_ig_in_government = yes
		}
		save_scope_as = ruling_ig
	}
	if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_council_elective
					value = strongly_approve
				}
			}
		}
		activate_law = law_type:law_council_elective
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_hereditary
					value = strongly_approve
				}
			}
		}
		activate_law = law_type:law_hereditary
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_parliamentary
					value = strongly_approve
				}
			}
		}
		activate_law = law_type:law_parliamentary
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_executive
					value = strongly_approve
				}
			}
		}
		activate_law = law_type:law_executive
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_theocratic
					value = strongly_approve
				}
			}
		}
		activate_law = law_type:law_theocratic
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_council_elective
					value = approve
				}
			}
		}
		activate_law = law_type:law_council_elective
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_hereditary
					value = approve
				}
			}
		}
		activate_law = law_type:law_hereditary
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_parliamentary
					value = approve
				}
			}
		}
		activate_law = law_type:law_parliamentary
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_executive
					value = approve
				}
			}
		}
		activate_law = law_type:law_executive
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_theocratic
					value = approve
				}
			}
		}
		activate_law = law_type:law_theocratic
	}
	else = {
		activate_law = law_type:law_executive
		if = {
			limit = {
				civil_war_origin_country ?= {
					has_law = law_type:law_hereditary
				}
			}
			set_variable = prov_gov_monarchy
		}
		else_if = {
			limit = {
				civil_war_origin_country ?= {
					has_law = law_type:law_theocratic
				}
			}
			set_variable = prov_gov_theocracy
		}
		else_if = {
			limit = {
				civil_war_origin_country ?= {
					has_law = law_type:law_council_elective
				}
			}
			set_variable = prov_gov_council_republic
		}
		set_variable = revolutionary_prov_gov_var
	}
}

enact_preferred_governance_principle_new = {
	random_interest_group = {
		limit = {
			is_in_government = yes
			is_strongest_ig_in_government = yes
		}
		save_scope_as = ruling_ig
	}
	random_law = {
		limit = {
			OR = {
				type = law_type:law_hereditary
				type = law_type:law_executive
				type = law_type:law_parliamentary
				type = law_type:law_theocratic
				type = law_type:law_council_elective
			}
			type = {
				save_temporary_scope_as = enacted_gov_pric
			}
			scope:ruling_ig = {
				law_stance = {
					law = scope:enacted_gov_pric
					value = strongly_approve
				}
			}
		}
		save_scope_as = preferred_gov_principles
	}
	if = {
		limit = {
			NOT = {
				exists = scope:preferred_gov_principles
			}
		}
		random_law = {
			limit = {
				OR = {
					type = law_type:law_hereditary
					type = law_type:law_executive
					type = law_type:law_parliamentary
					type = law_type:law_theocratic
					type = law_type:law_council_elective
				}
				type = {
					save_temporary_scope_as = enacted_gov_pric
				}
				scope:ruling_ig = {
					law_stance = {
						law = scope:enacted_gov_pric
						value = approve
					}
				}
			}
			save_scope_as = preferred_gov_principles
		}
	}
	if = {
		limit = {
			NOT = {
				exists = scope:preferred_gov_principles
			}
		}
		random_law = {
			limit = {
				OR = {
					type = law_type:law_hereditary
					type = law_type:law_executive
					type = law_type:law_parliamentary
					type = law_type:law_theocratic
					type = law_type:law_council_elective
				}
				type = {
					save_temporary_scope_as = enacted_gov_pric
				}
				scope:ruling_ig = {
					law_stance = {
						law = scope:enacted_gov_pric
						value = neutral
					}
				}
			}
			save_scope_as = preferred_gov_principles
		}
	}
	activate_law = scope:preferred_gov_principles
}

exile_character_with_martyrdom = {
	save_scope_as = martyred_exile_scope
	if = {
		limit = {
			NOT = {
				has_modifier = modifier_political_martyr
			}
		}
		add_modifier = modifier_political_martyr
	}
	if = {
		limit = {
			owner ?= {
				NOT = {
					any_primary_culture = {
						this = scope:martyred_exile_scope.culture
					}
				}
			}
		}
		if = {
			limit = {
				any_country = {
					NOT = {
						this = scope:martyred_exile_scope.owner
					}
					any_primary_culture = {
						this = scope:martyred_exile_scope.culture
					}
				}
			}
			ordered_country = {
				limit = {
					NOT = {
						this = scope:martyred_exile_scope.owner
					}
					any_primary_culture = {
						this = scope:martyred_exile_scope.culture
					}
				}
				order_by = country_rank
				create_diplomatic_catalyst = {
					type = catalyst_exiled_culture_member
					target = scope:martyred_exile_scope.owner
				}
			}
		}
	}
	clean_up_exile_character_roles = yes
	if = {
		limit = { is_in_exile_pool = no }
		exile_character = yes
	}
}

### Vargas

calculate_populism_progress = {
	# From Laws
	set_variable = { name = populism_progress_from_laws value = 0 }
	# Cops
	set_variable = { name = temp_policing_var_contribution value = institution:institution_police.investment }
	if = {
		limit = {
			has_law = law_type:law_no_police
		}
		change_variable = { name = temp_policing_var_contribution add = 0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_local_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.1 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_dedicated_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_militarized_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.5 }
	}
	
	# Internal Affairs
	set_variable = { name = temp_ha_var_contribution value = institution:institution_home_affairs.investment }
	if = {
		limit = {
			has_law = law_type:law_no_home_affairs
		}
		change_variable = { name = temp_ha_var_contribution add = 0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_guaranteed_liberties
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.1 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_national_guard
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_secret_police
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.5 }
	}
	change_variable = { name = populism_progress_from_laws add = var:temp_policing_var_contribution }
	change_variable = { name = populism_progress_from_laws add = var:temp_ha_var_contribution }
	remove_variable = temp_policing_var_contribution
	remove_variable = temp_ha_var_contribution
}

set_populism_vars = {
	set_variable = { name = populism_progress_from_laws value = 0 }
	set_variable = { name = populism_progress_var_add value = 0 }
}

clear_populism_vars = {
	remove_variable = populism_progress_from_laws
	remove_variable = populism_progress_var_add
}

### Communism

calculate_communism_progress = {
	# From Laws
	set_variable = { name = communism_progress_from_laws value = 0 }
	# Cops
	set_variable = { name = temp_policing_var_contribution value = institution:institution_police.investment }
	if = {
		limit = {
			has_law = law_type:law_no_police
		}
		change_variable = { name = temp_policing_var_contribution add = 0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_local_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.1 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_dedicated_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_militarized_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.5 }
	}
	
	# Internal Affairs
	set_variable = { name = temp_ha_var_contribution value = institution:institution_home_affairs.investment }
	if = {
		limit = {
			has_law = law_type:law_no_home_affairs
		}
		change_variable = { name = temp_ha_var_contribution add = 0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_guaranteed_liberties
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.1 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_national_guard
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_secret_police
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.5 }
	}
	if = {
		limit = {
			has_variable = temp_policing_var_contribution
		}
		change_variable = { name = communism_progress_from_laws add = var:temp_policing_var_contribution }
		remove_variable = temp_policing_var_contribution
	}
	if = {
		limit = {
			has_variable = temp_ha_var_contribution
		}
		change_variable = { name = communism_progress_from_laws add = var:temp_ha_var_contribution }
		remove_variable = temp_ha_var_contribution
	}
}

set_communism_vars = {
	set_variable = { name = communism_progress_from_laws value = 0 }
	set_variable = { name = communism_progress_var_add value = 0 }
}

clear_communism_vars = {
	remove_variable = communism_progress_from_laws
	remove_variable = communism_progress_var_add
}

# National Identity
calculate_national_identity_progress = {
	set_variable = { name = national_identity_progress_var_next value = 0 }
	set_variable = { name = national_identity_progress_from_igs value = 0 }

	# From Interest Groups
	every_interest_group = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_patriotic
				has_ideology = ideology:ideology_liberal
				has_ideology = ideology:ideology_liberal_modern
			}
		}
		ROOT = {
			set_variable = { name = ig_weight value = prev.ig_clout }
		}
		if = {
			limit = {
				is_in_government = yes
			}
			ROOT = {
				change_variable = { name = ig_weight multiply = 3 }
			}
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_igs add = var:ig_weight }
		}
	}

	#Wars
	set_variable = { name = national_identity_progress_from_wars value = 0 }
	every_scope_war = {
		limit = {
			has_war_support = { target = root value > 50 }
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_wars add = 0.50 }
		}
	}
	every_scope_war = {
		limit = {
			has_war_support = { target = root value <= 50 }
			has_war_support = { target = root value > 25 }
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_wars add = 0.25 }
		}
	}
	every_scope_war = {
		limit = {
			has_war_support = { target = root value <= 25 }
			has_war_support = { target = root value > 0 }
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_wars add = 0.10 }
		}
	}

	#Buildings
	set_variable = { name = national_identity_progress_from_universities value = 0 }
	every_scope_building = {
		limit = {
			OR = {
				is_building_type = building_arts_academy
				is_building_type = building_university
				is_building_type = building_government_administration
			}
			occupancy >= 0.75
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_universities add = prev.level }
		}
	}
	change_variable = { name = national_identity_progress_from_universities divide = 25 }

	set_variable = { name = national_identity_progress_from_prestige value = 0 }

	#Prestige
	ROOT = {
		change_variable = { name = national_identity_progress_from_prestige add = root.prestige }
	}
	change_variable = { name = national_identity_progress_from_prestige divide = 100 }

	set_variable = { name = national_identity_progress_from_homelands value = 0 }

	#Homelands
	every_scope_state = {
		limit = {
			NOT = {
				is_homeland_of_country_cultures = ROOT
			}
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_homelands subtract = 0.25 }
		}
	}

	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_from_igs }
	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_from_wars }
	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_from_universities }
	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_from_prestige }
	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_from_homelands }
	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_var_add }
}

add_national_identity_progress = {
	change_variable = { name = national_identity_progress_var add = var:national_identity_progress_var_next }
	clamp_variable = { name = national_identity_progress_var max = 100 min = 0 }
}

set_national_identity_vars = {
	set_variable = { name = national_identity_progress_from_igs value = 0 }
	set_variable = { name = national_identity_progress_from_wars value = 0 }
	set_variable = { name = national_identity_progress_from_universities value = 0 }
	set_variable = { name = national_identity_progress_from_prestige value = 0 }
	set_variable = { name = national_identity_progress_from_homelands value = 0 }
	set_variable = { name = national_identity_progress_var_add value = 0 }
	set_variable = { name = ig_weight value = 0 }
}

clear_national_identity_vars = {
	remove_variable = national_identity_progress_from_igs
	remove_variable = national_identity_progress_from_wars
	remove_variable = national_identity_progress_from_universities
	remove_variable = national_identity_progress_from_prestige
	remove_variable = national_identity_progress_from_homelands
	remove_variable = national_identity_progress_var_add
}

replicate_laws_from_root = {
	every_law = {
		limit = {
			ROOT = {
				has_law = PREV.type
			}
			PREV = {
				NOT = {
					has_law = PREV.type
				}
			}
		}
		PREV = {
			activate_law = PREV.type
		}
	}
}

replicate_laws_from_prev = {
	every_law = {
		limit = {
			PREV = {
				has_law = PREV.type
			}
			ROOT = {
				NOT = {
					has_law = PREV.type
				}
			}
		}
		ROOT = {
			activate_law = PREV.type
		}
	}
}

capitulate_to_revolution = {
	scope:ongoing_revolution_movement = { #Can't trigger if they want governance reforms anyway.
		this.most_desired_law ?= {
			save_scope_as = revolutionaries_law
		}
	}
	every_interest_group = {
		limit = {
			is_insurrectionary = yes
		}
		set_variable = { name = revolutionary_ig days = 7 }
	}
	ordered_interest_group = {
		limit = {
			is_insurrectionary = yes
		}
		order_by = ig_clout
		save_scope_as = revolution_leader_ig
	}
	activate_law = scope:revolutionaries_law
	
	every_interest_group = {
		limit = {
			has_variable = revolutionary_ig
		}
		owner = {
			add_loyalists = {
				value = 0.8
				interest_group = PREV
			}
		}
	}
	
	if = {
		limit = {
			country_has_voting_franchise = yes
		}
		call_election = {
			months = 6
		}
	}
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_hereditary
			}
		}
		hidden_effect = {
			scope:revolution_leader_ig = {
				leader = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	
	every_interest_group = {
		limit = {
			is_in_government = yes
		}
		remove_ruling_interest_group = yes
		add_modifier = {
			name = modifier_revolution_defeated_light
			months = normal_modifier_time
			is_decaying = yes
		}
	}
	
	every_interest_group = {
		limit = {
			has_variable = revolutionary_ig
		}
		hidden_effect = {
			abandon_revolution = yes
		}
		add_modifier = {
			name = modifier_revolution_victorious_light
			months = normal_modifier_time
			is_decaying = yes
		}
		if = {
			limit = {
				is_insurrectionary = no
			}
			add_ruling_interest_group = yes
		}
	}
}

handle_revolutionary_sps = {
	set_only_legal_party_from_ig = ruler.interest_group
	
	custom_tooltip = {
		text = sps_government_reshuffle_tt
		every_interest_group = {
			limit = {
				is_in_government = yes
				NOT = { #Removes all IGs from government that aren't in your party
					has_party = yes
				}
			}
			remove_ruling_interest_group = yes
		}
		every_interest_group = {
			limit = { #Adds all IGs that are in your party to the government
				is_in_government = no
				has_party = yes
			}
			add_ruling_interest_group = yes
		}
	}
}
generate_pro_lobby_diplomatic_pact_opportunity = {
	random_list = {
		20 = {
			trigger = {
				can_create_diplomatic_pact = { target = scope:relevant_country type = trade_agreement }
				NOT = {
					has_diplomatic_pact = {
						who = scope:relevant_country
						type = trade_agreement
					}
				}
			}
			set_variable = pro_lobby_proposal_trade_agreement
		}
		20 = {
			trigger = {
				can_create_diplomatic_pact = { target = scope:relevant_country type = defensive_pact }
				NOT = {
					has_diplomatic_pact = {
						who = scope:relevant_country
						type = defensive_pact
					}
				}
			}
			set_variable = pro_lobby_proposal_defensive_pact
		}
		20 = {
			trigger = {
				can_create_diplomatic_pact = { target = scope:relevant_country type = alliance }
				NOT = {
					has_diplomatic_pact = {
						who = scope:relevant_country
						type = alliance
					}
				}
			}
			set_variable = pro_lobby_proposal_alliance
		}
		20 = {
			trigger = {
				OR = {
					can_create_diplomatic_pact = { target = scope:relevant_country type = foreign_investment_agreement }
					can_create_diplomatic_pact = { target = scope:relevant_country type = foreign_investment_rights }
				}
				NOR = {
					has_diplomatic_pact = {
						who = scope:relevant_country
						type = foreign_investment_rights
					}
					has_diplomatic_pact = {
						who = scope:relevant_country
						type = foreign_investment_agreement
					}
				}
			}
			set_variable = pro_lobby_proposal_investment_agreement
		}
		20 = {
			trigger = {
				scope:relevant_country = {
					is_power_bloc_leader = yes
				}
				can_create_diplomatic_pact = { target = scope:relevant_country type = join_power_bloc }
				NOT = {
					is_in_same_power_bloc = scope:relevant_country
				}
			}
			set_variable = pro_lobby_proposal_power_bloc
		}
		20 = {
			trigger = {
				is_power_bloc_leader = yes
				can_create_diplomatic_pact = { target = scope:relevant_country type = invite_to_power_bloc }
				NOT = {
					is_in_same_power_bloc = scope:relevant_country
				}
			}
			set_variable = pro_lobby_proposal_power_bloc_invite
		}
		20 = {
			trigger = {
				can_create_diplomatic_pact = { target = scope:relevant_country type = military_assistance }
				NOT = {
					has_diplomatic_pact = {
						who = scope:relevant_country
						type = military_assistance
						is_initiator = yes
					}
				}
			}
			set_variable = pro_lobby_proposal_military_assistance
		}
	}
}

generate_pro_lobby_diplomatic_pact_proposal = {
	random_list = {
		20 = { # Break an alliance
			trigger = {
				can_break_diplomatic_pact = { target = scope:third_party_country type = alliance }
			}
			set_variable = pro_lobby_proposal_break_alliance
		}
		20 = { # Break a trade agreement
			trigger = {
				can_break_diplomatic_pact = { target = scope:third_party_country type = trade_agreement }
			}
			set_variable = pro_lobby_proposal_break_trade_agreement
		}
		20 = { # Break a defensive pact
			trigger = {
				can_break_diplomatic_pact = { target = scope:third_party_country type = defensive_pact }
			}
			set_variable = pro_lobby_proposal_break_defensive_pact
		}
		20 = { # Do a rivalry
			trigger = {
				can_create_diplomatic_pact = { target = scope:third_party_country type = rivalry }
			}
			set_variable = pro_lobby_proposal_rivalry
		}
		20 = { # Do an embargo
			trigger = {
				can_create_diplomatic_pact = { target = scope:third_party_country type = embargo }
			}
			set_variable = pro_lobby_proposal_embargo
		}
		20 = { # Do a war
			trigger = {
				pro_lobby_war_valid_check = yes
			}
			set_variable = pro_lobby_proposal_war
		}
		20 = { # Leave Power Bloc
			trigger = {
				pro_lobby_leave_power_bloc_valid_check = yes
			}
			set_variable = pro_lobby_proposal_leave_power_bloc
		}
	}
}

generate_anti_lobby_diplomatic_pact_opportunity = {
	random_list = {
		20 = {
			trigger = {
				can_create_diplomatic_pact = { target = scope:third_party_country type = trade_agreement }
				NOT = {
					has_diplomatic_pact = {
						who = scope:third_party_country
						type = trade_agreement
					}
				}
			}
			set_variable = anti_lobby_proposal_trade_agreement
		}
		20 = {
			trigger = {
				can_create_diplomatic_pact = { target = scope:third_party_country type = defensive_pact }
				NOT = {
					has_diplomatic_pact = {
						who = scope:third_party_country
						type = defensive_pact
					}
				}
			}
			set_variable = anti_lobby_proposal_defensive_pact
		}
		20 = {
			trigger = {
				can_create_diplomatic_pact = { target = scope:third_party_country type = alliance }
				NOT = {
					has_diplomatic_pact = {
						who = scope:third_party_country
						type = alliance
					}
				}
			}
			set_variable = anti_lobby_proposal_alliance
		}
		20 = {
			trigger = {
				OR = {
					can_create_diplomatic_pact = { target = scope:relevant_country type = foreign_investment_agreement }
					can_create_diplomatic_pact = { target = scope:relevant_country type = foreign_investment_rights }
				}
				NOR = {
					has_diplomatic_pact = {
						who = scope:third_party_country
						type = foreign_investment_rights
					}
					has_diplomatic_pact = {
						who = scope:third_party_country
						type = foreign_investment_agreement
					}
				}
			}
			set_variable = anti_lobby_proposal_investment_agreement
		}
		20 = {
			trigger = {
				scope:third_party_country = {
					is_power_bloc_leader = yes
				}
				can_create_diplomatic_pact = { target = scope:third_party_country type = join_power_bloc }
				NOT = {
					is_in_same_power_bloc = scope:third_party_country
				}
			}
			set_variable = anti_lobby_proposal_power_bloc
		}
		20 = {
			trigger = {
				is_power_bloc_leader = yes
				can_create_diplomatic_pact = { target = scope:third_party_country type = invite_to_power_bloc }
				NOT = {
					is_in_same_power_bloc = scope:third_party_country
				}
			}
			set_variable = anti_lobby_proposal_power_bloc_invite
		}
		20 = {
			trigger = {
				can_create_diplomatic_pact = { target = scope:third_party_country type = military_assistance }
				NOT = {
					has_diplomatic_pact = {
						who = scope:third_party_country
						type = military_assistance
						is_initiator = yes
					}
				}
			}
			set_variable = anti_lobby_proposal_military_assistance
		}
	}
}

generate_anti_lobby_diplomatic_pact_proposal = {
	random_list = {
		20 = { # Break an alliance
			trigger = {
				can_break_diplomatic_pact = { target = scope:relevant_country type = alliance }
			}
			set_variable = anti_lobby_proposal_break_alliance
		}
		20 = { # Break a trade agreement
			trigger = {
				can_break_diplomatic_pact = { target = scope:relevant_country type = trade_agreement }
			}
			set_variable = anti_lobby_proposal_break_trade_agreement
		}
		20 = { # Break a defensive pact
			trigger = {
				can_break_diplomatic_pact = { target = scope:relevant_country type = defensive_pact }
			}
			set_variable = anti_lobby_proposal_break_defensive_pact
		}
		20 = { # Do a rivalry
			trigger = {
				can_create_diplomatic_pact = { target = scope:relevant_country type = rivalry }
			}
			set_variable = anti_lobby_proposal_rivalry
		}
		20 = { # Do an embargo
			trigger = {
				can_create_diplomatic_pact = { target = scope:relevant_country type = embargo }
			}
			set_variable = anti_lobby_proposal_embargo
		}
		20 = { # Do a war
			trigger = {
				anti_lobby_war_valid_check = yes
			}
			set_variable = anti_lobby_proposal_war
		}
		20 = { # Leave Power Bloc
			trigger = {
				anti_lobby_leave_power_bloc_valid_check = yes
			}
			set_variable = anti_lobby_proposal_leave_power_bloc
		}
	}
}

clear_anti_lobby_vars = {
	remove_variable = anti_lobby_proposal_break_alliance
	remove_variable = anti_lobby_proposal_break_trade_agreement
	remove_variable = anti_lobby_proposal_break_defensive_pact
	remove_variable = anti_lobby_proposal_rivalry
	remove_variable = anti_lobby_proposal_embargo
	remove_variable = anti_lobby_proposal_war
	remove_variable = anti_lobby_proposal_leave_power_bloc
	remove_variable = anti_lobby_proposal_defensive_pact
	remove_variable = anti_lobby_proposal_military_assistance
	remove_variable = anti_lobby_proposal_alliance
	remove_variable = anti_lobby_proposal_trade_agreement
	remove_variable = anti_lobby_proposal_power_bloc
	remove_variable = anti_lobby_proposal_power_bloc_invite
	remove_variable = anti_lobby_proposal_investment_agreement
	remove_variable = anti_lobby_opportunity_target
	remove_variable = anti_lobby_demand_target
}

clear_pro_lobby_vars = {
	remove_variable = pro_lobby_proposal_defensive_pact
	remove_variable = pro_lobby_proposal_alliance
	remove_variable = pro_lobby_proposal_trade_agreement
	remove_variable = pro_lobby_proposal_power_bloc
	remove_variable = pro_lobby_proposal_power_bloc_invite
	remove_variable = pro_lobby_proposal_military_assistance
	remove_variable = pro_lobby_proposal_investment_agreement
	remove_variable = pro_lobby_proposal_break_alliance
	remove_variable = pro_lobby_proposal_break_trade_agreement
	remove_variable = pro_lobby_proposal_break_defensive_pact
	remove_variable = pro_lobby_proposal_rivalry
	remove_variable = pro_lobby_proposal_embargo
	remove_variable = pro_lobby_proposal_war
	remove_variable = pro_lobby_proposal_leave_power_bloc
	remove_variable = pro_lobby_demand_target
	remove_variable = pro_lobby_opportunity_target
}

generate_fascist_agitator = {
	custom_tooltip = {
		text = fascist_agitator_appears_tt
		create_character = {
			culture = primary_culture
			is_agitator = yes
			interest_group = ig:ig_urbanists
			ideology = ideology_fascist
			traits = {
				demagogue
				basic_political_operator
			}
		}
	}
}

add_small_european_radicals = {
	custom_tooltip = add_small_european_radicals_tt
	hidden_effect = {
		every_scope_culture = {
			limit = {
				has_discrimination_trait = european_heritage
			}
			ROOT = {
				add_radicals = {
					value = small_radicals
					culture = prev
				}
			}
		}
	}
}

add_medium_european_radicals = {
	custom_tooltip = add_medium_european_radicals_tt
	hidden_effect = {
		every_scope_culture = {
			limit = {
				has_discrimination_trait = european_heritage
			}
			ROOT = {
				add_radicals = {
					value = medium_radicals
					culture = prev
				}
			}
		}
	}
}

add_large_european_radicals = {
	custom_tooltip = add_large_european_radicals_tt
	hidden_effect = {
		every_scope_culture = {
			limit = {
				has_discrimination_trait = european_heritage
			}
			ROOT = {
				add_radicals = {
					value = large_radicals
					culture = prev
				}
			}
		}
	}
}

add_small_european_loyalists = {
	custom_tooltip = add_small_european_loyalists_tt
	hidden_effect = {
		every_scope_culture = {
			limit = {
				has_discrimination_trait = european_heritage
			}
			ROOT = {
				add_loyalists = {
					value = small_radicals
					culture = prev
				}
			}
		}
	}
}

add_medium_european_loyalists = {
	custom_tooltip = add_medium_european_loyalists_tt
	hidden_effect = {
		every_scope_culture = {
			limit = {
				has_discrimination_trait = european_heritage
			}
			ROOT = {
				add_loyalists = {
					value = medium_radicals
					culture = prev
				}
			}
		}
	}
}

add_large_european_loyalists = {
	custom_tooltip = add_large_european_loyalists_tt
	hidden_effect = {
		every_scope_culture = {
			limit = {
				has_discrimination_trait = european_heritage
			}
			ROOT = {
				add_loyalists = {
					value = large_radicals
					culture = prev
				}
			}
		}
	}
}

state_religion_switch_effect = {
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_state_atheism
			}
		}
		every_scope_character = {
			limit = {
				NOT = {
					religion = owner.religion
				}
				has_ideology = ideology:ideology_traditionalist
			}
			set_ideology = ideology:ideology_traditionalist_minoritarian
		}
		every_scope_character = {
			limit = {
				religion = owner.religion
				has_ideology = ideology:ideology_traditionalist_minoritarian
			}
			set_ideology = ideology:ideology_traditionalist
		}
	}
}

character_traditionalist_switch_effect = {
	if = {
		limit = {
			NOT = {
				religion = owner.religion
			}
			has_ideology = ideology:ideology_traditionalist
		}
		set_ideology = ideology:ideology_traditionalist_minoritarian
	}
	if = {
		limit = {
			religion = owner.religion
			has_ideology = ideology:ideology_traditionalist_minoritarian
		}
		set_ideology = ideology:ideology_traditionalist
	}
}

free_from_exile_effect = {
	remove_modifier = in_exile_modifier
	character_traditionalist_switch_effect = yes
}